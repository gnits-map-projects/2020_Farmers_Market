{"ast":null,"code":"!function (e, t) {\n  \"object\" == typeof exports && \"undefined\" != typeof module ? module.exports = t(require(\"react\")) : \"function\" == typeof define && define.amd ? define([\"react\"], t) : (e = e || self).Collapse = t(e.React);\n}(this, function (e) {\n  \"use strict\";\n\n  var t = \"default\" in e ? e.default : e;\n\n  function n(e, t, n) {\n    return t in e ? Object.defineProperty(e, t, {\n      value: n,\n      enumerable: !0,\n      configurable: !0,\n      writable: !0\n    }) : e[t] = n, e;\n  }\n\n  function r() {\n    return (r = Object.assign || function (e) {\n      for (var t = 1; t < arguments.length; t++) {\n        var n = arguments[t];\n\n        for (var r in n) Object.prototype.hasOwnProperty.call(n, r) && (e[r] = n[r]);\n      }\n\n      return e;\n    }).apply(this, arguments);\n  }\n\n  function i(e, t) {\n    var n = Object.keys(e);\n\n    if (Object.getOwnPropertySymbols) {\n      var r = Object.getOwnPropertySymbols(e);\n      t && (r = r.filter(function (t) {\n        return Object.getOwnPropertyDescriptor(e, t).enumerable;\n      })), n.push.apply(n, r);\n    }\n\n    return n;\n  }\n\n  function o(e) {\n    for (var t = 1; t < arguments.length; t++) {\n      var r = null != arguments[t] ? arguments[t] : {};\n      t % 2 ? i(r, !0).forEach(function (t) {\n        n(e, t, r[t]);\n      }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(r)) : i(r).forEach(function (t) {\n        Object.defineProperty(e, t, Object.getOwnPropertyDescriptor(r, t));\n      });\n    }\n\n    return e;\n  }\n\n  function c(e, t) {\n    if (null == e) return {};\n\n    var n,\n        r,\n        i = function (e, t) {\n      if (null == e) return {};\n      var n,\n          r,\n          i = {},\n          o = Object.keys(e);\n\n      for (r = 0; r < o.length; r++) n = o[r], t.indexOf(n) >= 0 || (i[n] = e[n]);\n\n      return i;\n    }(e, t);\n\n    if (Object.getOwnPropertySymbols) {\n      var o = Object.getOwnPropertySymbols(e);\n\n      for (r = 0; r < o.length; r++) n = o[r], t.indexOf(n) >= 0 || Object.prototype.propertyIsEnumerable.call(e, n) && (i[n] = e[n]);\n    }\n\n    return i;\n  }\n\n  function l(e, t) {\n    return function (e) {\n      if (Array.isArray(e)) return e;\n    }(e) || function (e, t) {\n      var n = [],\n          r = !0,\n          i = !1,\n          o = void 0;\n\n      try {\n        for (var c, l = e[Symbol.iterator](); !(r = (c = l.next()).done) && (n.push(c.value), !t || n.length !== t); r = !0);\n      } catch (e) {\n        i = !0, o = e;\n      } finally {\n        try {\n          r || null == l.return || l.return();\n        } finally {\n          if (i) throw o;\n        }\n      }\n\n      return n;\n    }(e, t) || function () {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    }();\n  }\n\n  var a = \"collapsed\",\n      u = \"collapsing\",\n      s = \"expanding\",\n      f = \"expanded\",\n      p = \"collapse-css-transition\",\n      y = \"div\",\n      d = \"0px\";\n\n  function h(e) {\n    requestAnimationFrame(function () {\n      requestAnimationFrame(e);\n    });\n  }\n\n  return function (n) {\n    var i = n.children,\n        v = n.transition,\n        b = n.style,\n        g = n.render,\n        O = n.elementType,\n        m = void 0 === O ? y : O,\n        w = n.isOpen,\n        j = n.collapseHeight,\n        x = void 0 === j ? d : j,\n        P = n.onInit,\n        E = n.onChange,\n        D = n.className,\n        S = void 0 === D ? p : D,\n        A = n.addState,\n        T = n.noAnim,\n        k = n.overflowOnExpanded,\n        C = c(n, [\"children\", \"transition\", \"style\", \"render\", \"elementType\", \"isOpen\", \"collapseHeight\", \"onInit\", \"onChange\", \"className\", \"addState\", \"noAnim\", \"overflowOnExpanded\"]),\n        I = function () {\n      return \"0px\" === x ? \"hidden\" : \"\";\n    },\n        N = l(e.useReducer(function (e) {\n      return e + 1;\n    }, 0), 2),\n        R = (N[0], N[1]),\n        q = e.useRef(),\n        H = l(e.useState(0), 2),\n        F = H[0],\n        z = H[1],\n        B = e.useRef({\n      collapse: w ? f : a,\n      style: {\n        height: w ? \"\" : x,\n        visibility: w ? \"\" : I()\n      }\n    }).current;\n\n    e.useEffect(function () {\n      F && G(E);\n    }, [F]);\n\n    var G = function (e) {\n      var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {};\n      e && (e.name, e(o({\n        state: B.collapse,\n        style: B.style\n      }, t)));\n    };\n\n    function J() {\n      q.current && (B.collapse = a, B.style = {\n        height: x,\n        visibility: I()\n      }, R(), setTimeout(function () {\n        return z(Date.now);\n      }, 0));\n    }\n\n    function K() {\n      q.current && (B.collapse = f, B.style = {\n        height: \"\",\n        visibility: \"\"\n      }, R(), setTimeout(function () {\n        return z(Date.now);\n      }, 0));\n    }\n\n    function L() {\n      return \"\".concat(q.current.scrollHeight, \"px\");\n    }\n\n    var M = B.collapse === f || B.collapse === s;\n    !M && w && function () {\n      if (q.current) {\n        if (T) return K();\n        B.collapse = s, h(function () {\n          q.current && B.collapse === s && (B.style = {\n            height: L(),\n            visibility: \"\"\n          }, z(Date.now));\n        });\n      }\n    }(), M && !w && function () {\n      if (q.current) {\n        if (T) return J();\n        B.collapse = u, B.style = {\n          height: L(),\n          visibility: \"\"\n        }, R(), h(function () {\n          q.current && B.collapse === u && (B.style = {\n            height: x,\n            visibility: \"\"\n          }, z(Date.now));\n        });\n      }\n    }();\n    var Q = o({\n      overflow: B.collapse === f && k ? \"\" : \"hidden\",\n      transition: v\n    }, b, {}, B.style),\n        U = m,\n        V = e.useCallback(function (e) {\n      e && (q.current = e, G(P, {\n        node: e\n      }));\n    }, [m]),\n        W = A ? \"\".concat(S, \" --c-\").concat(B.collapse) : S;\n    return t.createElement(U, r({\n      ref: V,\n      style: Q,\n      onTransitionEnd: function (e) {\n        var t = e.target,\n            n = e.propertyName;\n\n        if (t === q.current && \"height\" === n) {\n          var r = t.style.height;\n\n          switch (B.collapse, B.collapse) {\n            case s:\n              \"\" === r || r === x || K();\n              break;\n\n            case u:\n              \"\" === r || r !== x || J();\n          }\n        }\n      },\n      className: W\n    }, C), \"function\" == typeof i ? i(B.collapse) : \"function\" == typeof g ? g(B.collapse) : i);\n  };\n});","map":{"version":3,"sources":["../src/components/collapse/Collapse.jsx"],"names":["COLLAPSED","COLLAPSING","EXPANDING","EXPANDED","defaultClassName","defaultElementType","defaultCollapseHeight","nextFrame","callback","requestAnimationFrame","children","transition","style","render","elementType","isOpen","collapseHeight","onInit","onChange","className","addState","noAnim","overflowOnExpanded","rest","getCollapsedVisibility","forceUpdate","useReducer","_","elementRef","useRef","callbackTick","setCallbackTick","useState","state","collapse","height","visibility","current","useEffect","onCallback","params","name","setCollapsed","setTimeout","Date","now","getElementHeight","setExpanded","scrollHeight","target","propertyName","styleHeight","didOpen","setExpanding","setCollapsing","computedStyle","overflow","ElementType","callbackRef","useCallback","node","collapseClassName","React","ref","onTransitionEnd"],"mappings":"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","sourcesContent":["/* eslint-env browser */\n\n/**\n * All debug logs are removed on build\n */\n\nimport \"./collapse.css\";\nimport React, {\n  useState,\n  useEffect,\n  useRef,\n  useCallback,\n  useReducer\n} from \"react\";\nimport debugLog from \"./debugLog\";\n\n// using let instead of const,\n// experimenting with ES2015 bundle which gets a bit smaller when using let over const.\nlet COLLAPSED = \"collapsed\";\nlet COLLAPSING = \"collapsing\";\nlet EXPANDING = \"expanding\";\nlet EXPANDED = \"expanded\";\n\nlet defaultClassName = \"collapse-css-transition\";\nlet defaultElementType = \"div\";\nlet defaultCollapseHeight = \"0px\";\n\n/**\n *\n * @param {function} callback\n */\nfunction nextFrame(callback) {\n  requestAnimationFrame(function() {\n    //setTimeout(callback, 0); // NOT used because can be jumpy if click-spamming.\n    requestAnimationFrame(callback); // This is used.\n  });\n}\n\nfunction Collapse({\n  children,\n  transition,\n  style,\n  render,\n  elementType = defaultElementType,\n  isOpen,\n  collapseHeight = defaultCollapseHeight,\n  onInit,\n  onChange,\n  className = defaultClassName,\n  addState,\n  noAnim,\n  overflowOnExpanded,\n  ...rest\n}) {\n  let getCollapsedVisibility = () => (collapseHeight === \"0px\" ? \"hidden\" : \"\");\n\n  const [__, forceUpdate] = useReducer(_ => _ + 1, 0);\n\n  let elementRef = useRef();\n  let [callbackTick, setCallbackTick] = useState(0);\n\n  // Avoiding setState to control when stuff are updated.\n  // Might not be needed.\n  let state = useRef({\n    collapse: isOpen ? EXPANDED : COLLAPSED,\n    style: {\n      height: isOpen ? \"\" : collapseHeight,\n      visibility: isOpen ? \"\" : getCollapsedVisibility()\n    }\n  }).current;\n\n  useEffect(() => {\n    // Invoke callback when data are updated, use Effect to sync state.\n    callbackTick && onCallback(onChange);\n  }, [callbackTick]);\n\n  /**\n   *\n   * @param {function} callback\n   */\n  let onCallback = (callback, params = {}) => {\n    if (callback) {\n      debugLog(\"onCallback \" + callback.name);\n      callback({ state: state.collapse, style: state.style, ...params });\n    }\n  };\n\n  function setCollapsed() {\n    if (!elementRef.current) return; // might be redundant\n\n    // Update state\n    state.collapse = COLLAPSED;\n\n    debugLog(\"setCollapsed\");\n\n    state.style = {\n      height: collapseHeight,\n      visibility: getCollapsedVisibility()\n    };\n    forceUpdate();\n\n    setTimeout(() => setCallbackTick(Date.now), 0); // callback and re-render\n  }\n\n  function setCollapsing() {\n    if (!elementRef.current) return; // might be redundant\n\n    if (noAnim) {\n      return setCollapsed();\n    }\n\n    // Update state\n    state.collapse = COLLAPSING;\n\n    debugLog(\"setCollapsing\");\n\n    state.style = {\n      height: getElementHeight(),\n      visibility: \"\"\n    };\n    forceUpdate();\n\n    nextFrame(() => {\n      if (!elementRef.current) return;\n      if (state.collapse !== COLLAPSING) return;\n\n      state.style = {\n        height: collapseHeight,\n        visibility: \"\"\n      };\n      //forceUpdate();\n\n      setCallbackTick(Date.now); // callback and re-render\n    });\n  }\n\n  function setExpanding() {\n    if (!elementRef.current) return; // might be redundant\n\n    if (noAnim) {\n      return setExpanded();\n    }\n\n    // Updatetate\n    state.collapse = EXPANDING;\n\n    debugLog(\"setExpanding\");\n\n    nextFrame(() => {\n      if (!elementRef.current) return; // might be redundant\n      if (state.collapse !== EXPANDING) return;\n\n      state.style = {\n        height: getElementHeight(),\n        visibility: \"\"\n      };\n      // forceUpdate();\n\n      setCallbackTick(Date.now); // callback and re-render\n    });\n  }\n\n  function setExpanded() {\n    if (!elementRef.current) return; // might be redundant\n\n    // Update state\n    state.collapse = EXPANDED;\n\n    debugLog(\"setExpanded\");\n\n    state.style = {\n      height: \"\",\n      visibility: \"\"\n    };\n    forceUpdate();\n\n    setTimeout(() => setCallbackTick(Date.now), 0); // callback and re-render\n  }\n\n  function getElementHeight() {\n    // @ts-ignore\n    return `${elementRef.current.scrollHeight}px`;\n  }\n\n  function onTransitionEnd({ target, propertyName }) {\n    if (target === elementRef.current && propertyName === \"height\") {\n      let styleHeight = target.style.height;\n\n      debugLog(\"onTransitionEnd\", state.collapse, propertyName, styleHeight);\n\n      switch (state.collapse) {\n        case EXPANDING:\n          if (styleHeight === \"\" || styleHeight === collapseHeight)\n            // This is stale, a newer event has happened before this could execute\n            console.warn(\n              `onTransitionEnd height unexpected ${styleHeight}`,\n              \"ignore setExpanded\"\n            );\n          else setExpanded();\n          break;\n        case COLLAPSING:\n          if (styleHeight === \"\" || styleHeight !== collapseHeight)\n            // This is stale, a newer event has happened before this could execute\n            console.warn(\n              `onTransitionEnd height unexpected ${styleHeight}`,\n              \"ignore setCollapsed\"\n            );\n          else setCollapsed();\n          break;\n        default:\n          console.warn(\"Ignored in onTransitionEnd\", state.collapse);\n      }\n    }\n  }\n\n  // getDerivedStateFromProps\n  let didOpen = state.collapse === EXPANDED || state.collapse === EXPANDING;\n\n  if (!didOpen && isOpen) setExpanding();\n\n  if (didOpen && !isOpen) setCollapsing();\n  // END getDerivedStateFromProps\n\n  let overflow =\n    state.collapse === EXPANDED && overflowOnExpanded ? \"\" : \"hidden\";\n\n  let computedStyle = {\n    overflow,\n    transition,\n    ...style,\n    ...state.style\n  };\n  let ElementType = elementType;\n\n  let callbackRef = useCallback(\n    node => {\n      if (node) {\n        elementRef.current = node;\n        onCallback(onInit, { node });\n        debugLog(\"callback ref\");\n      }\n    },\n    [elementType]\n  );\n\n  let collapseClassName = addState\n    ? `${className} --c-${state.collapse}`\n    : className;\n\n  debugLog(\"Render\");\n\n  return (\n    <ElementType\n      ref={callbackRef}\n      style={computedStyle}\n      onTransitionEnd={onTransitionEnd}\n      className={collapseClassName}\n      {...rest}\n    >\n      {typeof children === \"function\"\n        ? children(state.collapse)\n        : typeof render === \"function\"\n        ? render(state.collapse)\n        : children}\n    </ElementType>\n  );\n}\n\nexport default Collapse;\n"]},"metadata":{},"sourceType":"script"}